<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="description" content="" />
<meta name="keywords" content="" />
<link rel="stylesheet" href="css/common.css" type="text/css" />
<link rel="stylesheet" href="css/kiwami_layout.css" type="text/css" />
<link rel="stylesheet" href="css/kiwami_lesson.css" type="text/css" />
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript" src="js/kiwami.js"></script>
<script type="text/javascript" src="js/kiwami_lesson3.js"></script>
<script type="text/javascript">
/*===　javascript 極み　ここにコードを記述　===*/
</script>
<title>javascript編</title>
</head>
<body>
<div id="top">
   <div id="header">
	  <div id="pr">
		 <p></p>
	  </div>
	</div>
	<div id="contents">
		<div id="menu"></div>
		<div id="main">
			<h3 id="title"></h3>
			<p>
				Ajaxはウェブブラウザ内で非同期通信を行いインターフェイスの構築を行うプログラミング手法です。<br/>
			</p>
			<p>
				<h2>jQuery.ajax(options)のオプション</h2>
				<div id="ex1">
					<table class="table" id="table_1">
						<thead>
							<tr>
								<th>キー</th>
								<th>型</th>
								<th>説明</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>type</td>
								<td>String</td>
								<td>初期値："GET"　"POST" もしくは "GET" を指定</td>
							</tr>
							<tr>
								<td>url</td>
								<td>String</td>
								<td>リクエスト先のURLを指定</td>
							</tr>
							<tr>
								<td>async</td>
								<td>Boolean</td>
								<td>初期値：true　デフォルトでは、全てのリクエストは非同期</td>
							</tr>
							<tr>
								<td>dataType</td>
								<td>String</td>
								<td>期待するサーバの応答データの形式を指定</br>
								xml：XMLドキュメント</br>
								html：HTMLテキスト</br>
								script：データをJavaScriptとして評価</br>
								json：JSONオブジェクト</br>
								jsonp：scriptタグを使用してJSONオブジェクトを取得</br>
								text：プレーンテキスト</br>
								</td>
							</tr>
							<tr>
								<td>data</td>
								<td>String</td>
								<td>サーバに送信するデータを指定</td>
							</tr>
							<tr>
								<td>success</td>
								<td>Function</td>
								<td>通信が成功したときに実行するコールバック関数を指定</td>
							</tr>
							<tr>
								<td>error</td>
								<td>Function</td>
								<td>通信が失敗したときに実行するコールバック関数を指定</td>
							</tr>
						</tbody>
					</table>
				</div>
			</p>
			<div style="font-size:80%">
				<h5>記述例</h5>
				<script type="text/javascript" language="javascript">
				var fn = function() {
					$.ajax({
						type: 'POST',
						url: 'http://www.yahoo.co.jp',
						async: true,
						dataType: 'html',
						data: {
							'param1': '1',
							'param1': '2'
						},
						success: function(result){
							$("#example1_response").text(result).css('background-color', 'cyan');
						},
						error: function(result){
							console.log(result);
						}
					});
				}
				document.write(html_replace(function_replace(fn)));
				</script>
			</div>
			<div id="ex_r3">
				<h5>記述例を参考にURL部分を置き換えて実行してください。</h5>
				<textarea id="example1" rows="18" cols="84" ></textarea>
				<br>
				<div>
					<input type="button" onClick="response_build('example1');" value="スクリプト実行">
				</div>
				<div id="example1_response" class="response">
					実行結果を表示
				</div>
				</br>
			</div>
			<p>
				<h2>ブラウザーのエラー時の確認</h2>
				consoleオブジェクトのconsole.log(変数)で対象の中身を確認できます。<br />
			</p>
			<p>
				<h2>クロスドメイン制約</h2>
				ブラウザのセキュリティの問題上、実行するHTMLファイルが置かれているドメインの<br />
				サーバとしか通信できないという制約。<br />
				業務で実装したWEBサービス内であれば同じドメインなのでこの問題は起きませんが外部の<br />
				APIサービスを使用する場合にこの制約に引っかかります。<br />
				<br />
				<h6>クロスドメイン制約を回避する代表的な方法</h6>
				<div id="ex2">
					<table class="table" id="table_2">
						<thead>
							<tr>
								<th>方法</th>
								<th>説明</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>Access-Control-Allow-Originを設定</td>
								<td>アクセス先のサーバーサイドでの設定で許可する</td>
							</tr>
							<tr>
								<td>プログラムを経由</td>
								<td>同一のドメインへAjax通信を行いリダイレクト等を行う</td>
							</tr>
							<tr>
								<td>JSONP形式で送信</td>
								<td>htmlがjsファイルとして外部ファイルを読み込めることを利用してJavaScriptで受け取って、処理する</td>
							</tr>
						</tbody>
					</table>
				</div>
			</p>
		</div>
		<div id="sub">
			<div class="section">
				<h3>練習１</h3>
				<a href="http://zipcloud.ibsnet.co.jp">Zip Cloud</a>のAPIで郵便番号(1510053)を設定し住所(address1〜address3)の値を表示して下さい</br>
				条件：</br>
				url : http://zipcloud.ibsnet.co.jp/api/search</br>
				type: 'POST'</br>
				data: 'zipcode'</br>
				dataType: 'jsonp'</br>
				実行結果id : practice1_response</br>
				<textarea id="practice1" rows="18" cols="84" ></textarea>
				<br>
				<div>
					<input type="button" onClick="response_build('practice1');" value="スクリプト実行">
					<input type="button" onClick="answer_build_1('practice1_response');" value="回答結果を実行">
					<input type="button" onClick="answer_reset_1('practice1_response');" value="実行結果をリセット">
				</div>
				<div id="practice1_response" class="response">
					実行結果を表示
				</div>
			</div>
			<div class="section">
				<h3>練習２</h3>
				<a href="http://www.ekidata.jp/api/api_pref.php">駅データJP</a>のAPIで東京にある路線をスクリプトで取得してプルダウン表示して下さい</br>
				条件：</br>
				url : http://www.ekidata.jp/api/p/13.json</br>
				type: 'GET'</br>
				dataType: 'script'</br>
				プルダウンid : practice2_select</br>
				プルダウン形式 : &lt;option value="路線CD"&gt;路線名&lt;/option&gt;</br>
				<textarea id="practice2" rows="24" cols="84" ></textarea>
				<br>
				<div>
					<input type="button" onClick="response_build('practice2');" value="スクリプト実行">
					<input type="button" onClick="answer_build_2('practice2_select');" value="回答結果を実行">
					<input type="button" onClick="answer_reset_2('practice2_select');" value="実行結果をリセット">
				</div>
				<div id="practice2_response">
					実行結果を表示：
					<select id="practice2_select">
						<option value="">選択してください</option>
					</select>
				</div>
			</div>
		</div>  
		<div id="pageTop">
			<a href="#">ページのトップへ戻る</a>
		</div>
	</div>
	<div id="footer">
		<div class="copyright">Copyright &copy; 2016 開発サービス課 All Rights Reserved.</div>
	</div>
</div>
</body>
</html>